{"ast":null,"code":"import _asyncToGenerator from \"/Users/ivangarciaparras/Git/ivan-garcia-parras/homebridge-eufy-legacy/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { ModalDismissReasons } from '@ng-bootstrap/ng-bootstrap';\nimport { faScrewdriverWrench } from '@fortawesome/free-solid-svg-icons';\nimport { faEyeSlash } from '@fortawesome/free-solid-svg-icons';\nimport { faRotate } from '@fortawesome/free-solid-svg-icons';\nimport { DeviceImage } from '../util/deviceToImagesMap';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@ng-bootstrap/ng-bootstrap\";\nimport * as i2 from \"../plugin.service\";\nimport * as i3 from \"@angular/router\";\nimport * as i4 from \"@angular/common\";\nimport * as i5 from \"@fortawesome/angular-fontawesome\";\n\nfunction AccessoryListComponent_ng_template_0_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r6 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 2)(1, \"h4\", 3);\n    i0.ɵɵtext(2, \"Refresh stations and devices\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"button\", 4);\n    i0.ɵɵlistener(\"click\", function AccessoryListComponent_ng_template_0_Template_button_click_3_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r6);\n      const modal_r4 = restoredCtx.$implicit;\n      return modal_r4.dismiss(\"Cross click\");\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(4, \"div\", 5)(5, \"div\", 6);\n    i0.ɵɵtext(6, \" To refresh all stations and devices you will be logged into your eufy account. This can interfere with the plugins connection to the eufy cloud. \");\n    i0.ɵɵelement(7, \"p\");\n    i0.ɵɵelementStart(8, \"b\", 7);\n    i0.ɵɵtext(9, \"We strongly recommened that you restart the plugin after you're done with the configuration even if you didn't change any settings.\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(10, \"p\");\n    i0.ɵɵtext(11, \" Otherwise you might experience glitches like no longer working push notifications for the plugin (see \");\n    i0.ɵɵelementStart(12, \"a\", 8);\n    i0.ɵɵtext(13, \"here\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(14, \" for more information). \");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(15, \"div\", 9)(16, \"a\", 10);\n    i0.ɵɵlistener(\"click\", function AccessoryListComponent_ng_template_0_Template_a_click_16_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r6);\n      const modal_r4 = restoredCtx.$implicit;\n      return modal_r4.close(\"Login\");\n    });\n    i0.ɵɵtext(17, \"Login with eufy\");\n    i0.ɵɵelementEnd()();\n  }\n}\n\nfunction AccessoryListComponent_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 11)(1, \"div\", 12);\n    i0.ɵɵelement(2, \"div\", 13);\n    i0.ɵɵelementStart(3, \"div\", 14)(4, \"div\", 15)(5, \"div\", 16);\n    i0.ɵɵtext(6, \" Loading Accessories... \");\n    i0.ɵɵelementStart(7, \"div\", 17);\n    i0.ɵɵelement(8, \"div\", 18);\n    i0.ɵɵelementEnd()()()();\n    i0.ɵɵelement(9, \"div\", 13);\n    i0.ɵɵelementEnd()();\n  }\n}\n\nfunction AccessoryListComponent_div_3_div_17_span_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 42);\n    i0.ɵɵelement(1, \"fa-icon\", 43);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r11 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"icon\", ctx_r11.ignoreIcon);\n  }\n}\n\nfunction AccessoryListComponent_div_3_div_17_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 31)(1, \"div\", 32)(2, \"div\", 33)(3, \"a\", 34)(4, \"div\", 35);\n    i0.ɵɵelement(5, \"img\", 36);\n    i0.ɵɵelementStart(6, \"span\", 37);\n    i0.ɵɵelement(7, \"fa-icon\", 38);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(8, AccessoryListComponent_div_3_div_17_span_8_Template, 2, 1, \"span\", 39);\n    i0.ɵɵelementEnd()()()();\n    i0.ɵɵelementStart(9, \"span\", 40);\n    i0.ɵɵtext(10);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"span\", 41);\n    i0.ɵɵtext(12);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const station_r10 = ctx.$implicit;\n    const ctx_r8 = i0.ɵɵnextContext(2);\n    let tmp_1_0;\n    i0.ɵɵadvance(3);\n    i0.ɵɵpropertyInterpolate1(\"routerLink\", \"/stationConfig/\", station_r10.uniqueId, \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"src\", \"assets/devices/\" + (ctx_r8.DeviceImage.get(station_r10.type) ? (tmp_1_0 = ctx_r8.DeviceImage.get(station_r10.type)) == null ? null : tmp_1_0.image : \"unknown.png\"), i0.ɵɵsanitizeUrl);\n    i0.ɵɵattribute(\"style\", ctx_r8.getDevicePanelStyle(station_r10), i0.ɵɵsanitizeStyle);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"icon\", ctx_r8.settingsIcon);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", station_r10.ignored);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(station_r10.cachedName ? station_r10.cachedName : station_r10.displayName);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"(\", station_r10.uniqueId, \")\");\n  }\n}\n\nfunction AccessoryListComponent_div_3_div_24_span_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 42);\n    i0.ɵɵelement(1, \"fa-icon\", 43);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r13 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"icon\", ctx_r13.ignoreIcon);\n  }\n}\n\nfunction AccessoryListComponent_div_3_div_24_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 31)(1, \"div\", 32)(2, \"div\", 33)(3, \"a\", 34)(4, \"div\", 35);\n    i0.ɵɵelement(5, \"img\", 36);\n    i0.ɵɵelementStart(6, \"span\", 37);\n    i0.ɵɵelement(7, \"fa-icon\", 38);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(8, AccessoryListComponent_div_3_div_24_span_8_Template, 2, 1, \"span\", 39);\n    i0.ɵɵelementEnd()()()();\n    i0.ɵɵelementStart(9, \"span\", 40);\n    i0.ɵɵtext(10);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"span\", 41);\n    i0.ɵɵtext(12);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const device_r12 = ctx.$implicit;\n    const ctx_r9 = i0.ɵɵnextContext(2);\n    let tmp_1_0;\n    i0.ɵɵadvance(3);\n    i0.ɵɵpropertyInterpolate1(\"routerLink\", \"/cameraConfig/\", device_r12.uniqueId, \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"src\", \"assets/devices/\" + (ctx_r9.DeviceImage.get(device_r12.type) ? (tmp_1_0 = ctx_r9.DeviceImage.get(device_r12.type)) == null ? null : tmp_1_0.image : \"unknown.png\"), i0.ɵɵsanitizeUrl);\n    i0.ɵɵattribute(\"style\", ctx_r9.getDevicePanelStyle(device_r12), i0.ɵɵsanitizeStyle);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"icon\", ctx_r9.settingsIcon);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", device_r12.ignored);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(device_r12.cachedName ? device_r12.cachedName : device_r12.displayName);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"(\", device_r12.uniqueId, \")\");\n  }\n}\n\nfunction AccessoryListComponent_div_3_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r15 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 11)(1, \"div\", 19)(2, \"div\", 20)(3, \"button\", 21);\n    i0.ɵɵlistener(\"click\", function AccessoryListComponent_div_3_Template_button_click_3_listener() {\n      i0.ɵɵrestoreView(_r15);\n      const ctx_r14 = i0.ɵɵnextContext();\n\n      const _r0 = i0.ɵɵreference(1);\n\n      return ctx_r14.openReloadModal(_r0);\n    });\n    i0.ɵɵelement(4, \"fa-icon\", 22);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(5, \"div\", 23)(6, \"a\", 24);\n    i0.ɵɵtext(7, \"Plugin Settings\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelement(8, \"p\");\n    i0.ɵɵelementStart(9, \"span\");\n    i0.ɵɵtext(10, \"Click on any device below to access its settings.\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(11, \"p\");\n    i0.ɵɵelementStart(12, \"div\", 25)(13, \"div\", 26);\n    i0.ɵɵtext(14, \" Stations \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(15, \"div\", 27)(16, \"div\", 19);\n    i0.ɵɵtemplate(17, AccessoryListComponent_div_3_div_17_Template, 13, 7, \"div\", 28);\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelement(18, \"p\");\n    i0.ɵɵelementStart(19, \"div\", 25)(20, \"div\", 26);\n    i0.ɵɵtext(21, \" Devices \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(22, \"div\", 29)(23, \"div\", 19);\n    i0.ɵɵtemplate(24, AccessoryListComponent_div_3_div_24_Template, 13, 7, \"div\", 28);\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelement(25, \"p\");\n    i0.ɵɵelementStart(26, \"span\")(27, \"i\");\n    i0.ɵɵtext(28, \"The images used above are 'best effort' for now, since we do not own every eufy device. If you experience that your device is depicted with a wrong image please feel free to let us know in an issue on our \");\n    i0.ɵɵelementStart(29, \"a\", 30);\n    i0.ɵɵtext(30, \"Github page.\");\n    i0.ɵɵelementEnd()()()();\n  }\n\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"icon\", ctx_r3.reloadIcon);\n    i0.ɵɵadvance(13);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r3.stations);\n    i0.ɵɵadvance(7);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r3.devices);\n  }\n}\n\nexport let AccessoryListComponent = /*#__PURE__*/(() => {\n  class AccessoryListComponent {\n    constructor(modalService, pluginService, route, routerService) {\n      this.modalService = modalService;\n      this.pluginService = pluginService;\n      this.route = route;\n      this.routerService = routerService;\n      this.stations = [];\n      this.devices = [];\n      this.settingsIcon = faScrewdriverWrench;\n      this.ignoreIcon = faEyeSlash;\n      this.reloadIcon = faRotate;\n      this.DeviceImage = DeviceImage;\n      this.closeResult = '';\n    }\n\n    ngOnInit() {\n      this.waitForAccessories = this.route.snapshot.paramMap.get('waitForAccessories') === 'true';\n      this.pluginService.addEventListener('newAccessories', () => {\n        console.log('plugin accessories have changed. updating...');\n        this.updateDevices();\n        this.updateStations();\n      });\n      this.updateStations();\n      this.updateDevices();\n\n      if (!this.waitForAccessories && this.stations.length === 0 && this.devices.length === 0) {\n        this.pluginService.loadStoredAccessories().then(result => {\n          if (!result) {\n            this.routerService.navigateByUrl('/login');\n          }\n        }).catch(err => {\n          this.routerService.navigateByUrl('/login');\n        });\n      }\n    }\n\n    updateStations() {\n      this.stations = this.pluginService.getStations();\n      this.updateProperties();\n    }\n\n    updateDevices() {\n      this.devices = this.pluginService.getDevices();\n      this.updateProperties();\n    }\n\n    updateProperties() {\n      var _this = this;\n\n      return _asyncToGenerator(function* () {\n        const config = yield _this.pluginService.getConfig();\n\n        if (Array.isArray(config['ignoreStations'])) {\n          _this.stations.forEach(station => {\n            station.ignored = config['ignoreStations'].find(uId => uId === station.uniqueId) !== undefined;\n          });\n        }\n\n        if (Array.isArray(config['ignoreDevices'])) {\n          _this.devices.forEach(device => {\n            device.ignored = config['ignoreDevices'].find(uId => uId === device.uniqueId) !== undefined;\n          });\n        } // load cached Names\n\n\n        _this.stations.forEach(station => {\n          _this.pluginService.getCachedName(station).then(cachedName => station.cachedName = cachedName);\n        });\n\n        _this.devices.forEach(device => {\n          _this.pluginService.getCachedName(device).then(cachedName => device.cachedName = cachedName);\n        });\n      })();\n    }\n\n    openReloadModal(content) {\n      this.modalService.open(content, {\n        ariaLabelledBy: 'modal-basic-title',\n        centered: true\n      }).result.then(result => {\n        this.closeResult = `Closed with: ${result}`;\n      }, reason => {\n        this.closeResult = `Dismissed ${this.getDismissReason(reason)}`;\n      });\n    }\n\n    getDismissReason(reason) {\n      if (reason === ModalDismissReasons.ESC) {\n        return 'by pressing ESC';\n      } else if (reason === ModalDismissReasons.BACKDROP_CLICK) {\n        return 'by clicking on a backdrop';\n      } else {\n        return `with: ${reason}`;\n      }\n    }\n\n    getDevicePanelStyle(accessory) {\n      var _a;\n\n      let style = '';\n\n      if (accessory.ignored) {\n        style += 'opacity: 0.2;';\n      }\n\n      if (DeviceImage.get(accessory.type)) {\n        style += 'padding:' + ((_a = DeviceImage.get(accessory.type)) === null || _a === void 0 ? void 0 : _a.padding);\n      } else {\n        style += 'padding:20px';\n      }\n\n      return style;\n    }\n\n  }\n\n  AccessoryListComponent.ɵfac = function AccessoryListComponent_Factory(t) {\n    return new (t || AccessoryListComponent)(i0.ɵɵdirectiveInject(i1.NgbModal), i0.ɵɵdirectiveInject(i2.PluginService), i0.ɵɵdirectiveInject(i3.ActivatedRoute), i0.ɵɵdirectiveInject(i3.Router));\n  };\n\n  AccessoryListComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: AccessoryListComponent,\n    selectors: [[\"app-accessory-list\"]],\n    inputs: {\n      waitForAccessories: \"waitForAccessories\"\n    },\n    decls: 4,\n    vars: 2,\n    consts: [[\"reloadModal\", \"\"], [\"class\", \"container\", 4, \"ngIf\"], [1, \"modal-header\"], [\"id\", \"modal-basic-title\", 1, \"modal-title\"], [\"type\", \"button\", \"aria-label\", \"Close\", 1, \"btn-close\", 3, \"click\"], [1, \"modal-body\"], [1, \"mb-3\"], [2, \"color\", \"#dc3545\"], [\"href\", \"https://github.com/homebridge-eufy-security/plugin/issues/59#issuecomment-1147314942\", \"target\", \"_blank\", \"rel\", \"noopener noreferrer\"], [1, \"modal-footer\"], [\"routerLink\", \"/login\", 1, \"btn\", \"btn-success\", 3, \"click\"], [1, \"container\"], [1, \"row\", \"pl-5\", \"pr-5\"], [1, \"col\", 2, \"max-width\", \"20%\"], [1, \"col\", \"d-flex\", \"justify-content-center\"], [1, \"card\", \"shadow-sm\", \"text-center\", \"pt-3\", \"pb-3\", 2, \"width\", \"100%\"], [1, \"mx-auto\"], [1, \"progress\", 2, \"height\", \"8px\"], [\"role\", \"progressbar\", \"aria-valuenow\", \"75\", \"aria-valuemin\", \"0\", \"aria-valuemax\", \"100\", 1, \"progress-bar\", \"progress-bar-striped\", \"bg-info\", \"progress-bar-animated\", 2, \"width\", \"75%\"], [1, \"row\"], [1, \"col-6\"], [\"type\", \"button\", 1, \"btn\", \"btn-success\", 3, \"click\"], [\"size\", \"lg\", 3, \"icon\"], [1, \"col-6\", \"text-end\"], [\"routerLink\", \"/advancedConfig\", 1, \"btn\", \"btn-secondary\"], [1, \"card\"], [1, \"card-header\"], [1, \"card-body\", \"pt-0\", \"pb-0\"], [\"class\", \"col-6 col-sm-4 mt-3 mb-3 d-flex flex-column align-items-center\", 4, \"ngFor\", \"ngForOf\"], [1, \"card-body\"], [\"href\", \"https://github.com/homebridge-eufy-security/plugin\", \"target\", \"_blank\", \"rel\", \"noopener noreferrer\"], [1, \"col-6\", \"col-sm-4\", \"mt-3\", \"mb-3\", \"d-flex\", \"flex-column\", \"align-items-center\"], [1, \"col-12\", \"col-sm-7\"], [1, \"text-center\"], [2, \"color\", \"black\", 3, \"routerLink\"], [1, \"device\", \"ratio\", \"ratio-1x1\", \"border\", \"rounded\", \"shadow-sm\"], [1, \"deviceimage\", 3, \"src\"], [1, \"devicesettingsicon\", \"d-flex\", \"border\", \"align-items-center\", \"justify-content-center\", 2, \"z-index\", \"15\"], [\"size\", \"2x\", 3, \"icon\"], [\"class\", \"d-flex border align-items-top justify-content-end\", \"style\", \"z-index: 20;\", 4, \"ngIf\"], [1, \"col-12\", \"text-center\"], [1, \"col-12\", \"serial\", \"fw-light\", \"text-center\"], [1, \"d-flex\", \"border\", \"align-items-top\", \"justify-content-end\", 2, \"z-index\", \"20\"], [\"size\", \"xs\", 1, \"mt-sm-1\", \"m-sm-2\", \"m-1\", \"mt-0\", 3, \"icon\"]],\n    template: function AccessoryListComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵtemplate(0, AccessoryListComponent_ng_template_0_Template, 18, 0, \"ng-template\", null, 0, i0.ɵɵtemplateRefExtractor);\n        i0.ɵɵtemplate(2, AccessoryListComponent_div_2_Template, 10, 0, \"div\", 1);\n        i0.ɵɵtemplate(3, AccessoryListComponent_div_3_Template, 31, 3, \"div\", 1);\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngIf\", ctx.stations.length === 0 && ctx.devices.length === 0);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.stations.length !== 0 || ctx.devices.length !== 0);\n      }\n    },\n    directives: [i3.RouterLinkWithHref, i4.NgIf, i5.FaIconComponent, i4.NgForOf],\n    styles: [\".device[_ngcontent-%COMP%]:hover{transform:scale(1.05);border-color:#ffc107!important;color:#ffc107}.device[_ngcontent-%COMP%]{background-color:#fff!important;color:#000!important}.device[_ngcontent-%COMP%]:hover   .deviceimage[_ngcontent-%COMP%]{opacity:.5}.device[_ngcontent-%COMP%]   .devicesettingsicon[_ngcontent-%COMP%]{display:none!important}.device[_ngcontent-%COMP%]:hover   .devicesettingsicon[_ngcontent-%COMP%]{display:flex!important;color:#ffa000!important}.serial[_ngcontent-%COMP%]{font-size:12px}\"]\n  });\n  return AccessoryListComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}